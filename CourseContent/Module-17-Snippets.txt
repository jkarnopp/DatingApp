===========
Snippets for Linux server
===========

*** create a new user in mysql

CREATE USER 'appuser'@'localhost' IDENTIFIED BY 'password';

GRANT ALL PRIVILEGES ON * . * TO 'appuser'@'localhost';

FLUSH PRIVILEGES;


*** apache configuration

a2enmod proxy proxy_http proxy_html

*** create the config file for datingapp

sudo nano /etc/apache2/conf-enabled/datingapp.conf

<VirtualHost *:80>
ProxyPreserveHost On
ProxyPass / http://127.0.0.1:5000/
ProxyPassReverse / http://127.0.0.1:5000/
ErrorLog /var/log/apache2/datingapp-error.log
CustomLog /var/log/apache2/datingapp-access.log common
</VirtualHost>

*** restart apache

sudo service apache2 restart

*** create temp app

mkdir testapp
cd testapp

dotnet new mvc

dotnet publish

sudo cp -a ~/testapp/bin/Debug/netcoreapp2.0/publish/ /var/testapp/

*** create kestrel service config

sudo nano /etc/systemd/system/kestrel-testapp.service

[Unit]
Description=Example ASP .NET Web Application running on Ubuntu 16.04
[Service]
WorkingDirectory=/var/testapp
ExecStart=/usr/bin/dotnet /var/testapp/testapp.dll
Restart=always
RestartSec=10
SyslogIdentifier=dotnet-demo
User=www-data
Environment=ASPNETCORE_ENVIRONMENT=Production
[Install]
WantedBy=multi-user.target

*** enable and start the kestrel service

sudo systemctl enable kestrel-testapp.service
sudo systemctl start kestrel-testapp.service


*** vscode deploy configuration

{
  "deploy": {
    "packages": [
      {
        "name": "Version 1.0",
        "description": "Dating App Version 1.0",
        "files": ["DatingApp.API/bin/Debug/netcoreapp2.0/publish/**"]
      }
    ],
    "targets": [
      {
        "type": "sftp",
        "name": "Linux",
        "description": "Remote Linux Server",
        "dir": "/var/datingapp",
        "mappings": [
            {
                "source": "/DatingApp.API/bin/Debug/netcoreapp2.0/publish",
                "target": "/"
            }
        ],
        "host": "your servers ip address",
        "port": 22,
        "user": "root", "password": "your password",
        "checkBeforeDeploy": true
      }
    ]
  }
}

*** update kestrel service settings

sudo nano /etc/systemd/system/kestrel-testapp.service

sudo systemctl stop kestrel-testapp.service
sudo systemctl enable kestrel-testapp.service
sudo systemctl start kestrel-testapp.service
sudo service apache2 restart

*** Problems?

Use:

journalctl -u kestrel-testapp.service

Which will give you the logs for the service.

